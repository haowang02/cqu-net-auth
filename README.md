# 重庆大学校园网认证脚本

持续监测网络认证状态并认证校园网，适合服务器、路由器等场景使用。效果如下：

```bash
$ python login.py --account 2018xxxx --password xxxxxxxx --term_type pc --log_level debug
2025-04-17 18:12:08,775 - INFO - 每5秒检查一次网络状态, 如果掉线则重新认证, CTRL+C 停止程序
2025-04-17 18:12:09,085 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:14,156 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:19,281 - INFO - 正在认证: 账户(2018xxxx), 设备类型(pc), 校园网IP(10.xx.xx.xx)
2025-04-17 18:12:19,316 - INFO - 认证成功, 5秒后重新检查网络状态...
2025-04-17 18:12:24,386 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:29,522 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:34,564 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:39,599 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:44,693 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:49,758 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:12:54,815 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:13:00,006 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:13:08,044 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:16,060 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:24,073 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:32,083 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:40,119 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:48,135 - WARNING - 无法获取校园网 IP, 请检查链路是否正常, 5秒后重试...
2025-04-17 18:13:53,364 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:13:58,596 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:14:03,829 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
2025-04-17 18:14:09,075 - DEBUG - 网络连接正常, 已认证账户[王X 2018xxxx], 5秒后重新检查网络状态...
```

## 直接运行

```
# 环境变量传参
ACCOUNT=校园网账户 PASSWORD=校园网密码 TERM_TYPE=终端类型 python login.py
# 注意：终端类型选填 mobile 或 pc

# 命令行传参 (兼容 Windows 系统)
python login.py --account 校园网账户 --password 校园网密码 --term_type 终端类型
# 注意：终端类型选填 mobile 或 pc
```

## Docker 容器运行

构建容器:

```bash
docker build -t cqu-net-auth .
```

启动:

```bash
docker run -d \
    --name cqu-net-auth \
    --restart always \
    -e ACCOUNT="校园网账户" \
    -e PASSWORD="校园网密码" \
    -e TERM_TYPE="终端类型" \           # 注意：终端类型选填 mobile 或 pc
    cqu-net-auth
```

查看日志:

```bash
docker logs -f cqu-net-auth
```

## 其他常用命令

登出校园网

```bash
python logout.py
```

检查当前认证的校园网账户
```bash
# 方法1
curl -s "http://10.254.7.4/" |
  iconv -f GBK -t UTF-8 |
  grep -oP "uid='.*?'|NID='.*?'"

# 方法2
curl -s "http://10.254.7.4/drcom/chkstatus?callback=dr1002&jsVersion=4.X&v=5505&lang=zh" |
  iconv -f GBK -t UTF-8 |
  sed -E 's/dr1002\((.*)\)/\1/' |
  jq
```

检查校园网 IP
```bash
curl -s "http://10.254.7.4/a79.htm" |
  iconv -f GBK -t UTF-8 |
  grep -oP "v46ip='.*?'"
```
